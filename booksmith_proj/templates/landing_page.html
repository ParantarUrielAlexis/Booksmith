{% extends 'base.html' %} {% load static %} {% block title %}Landing Page
{%endblock %} {% block extra_css %}
<link rel="stylesheet" href="{% static 'css_files/landing_page.css' %}" />
{% endblock %} {% block content %}
<!-- Slider Section for Best Sellers -->
<div class="slider">
  <h2>Best Sellers</h2>
  <div class="list">
    <!-- Loop through best sellers and display each book -->
    {% for book in best_sellers %}
    <div class="item {% if forloop.first %}active{% endif %}">
      <img src="{{ book.image_url }}" alt="{{ book.title }}" />
      <div class="content">
        <p>{{ book.category }}</p>
        <br />
        <h2>{{ book.title }}</h2>
        <br />
        <p>{{ book.description }}</p>
        <br /><br />
        <!-- Price section with a span for highlighting -->
        {% if book.discount_percent > 0 %}
        <p><s>${{ book.price|floatformat:2 }}</s></p>
        <br /><br />
        <p>
          <span class="highlight-price"
            >${{ book.discounted_price|floatformat:2 }}</span
          >
          <span class="discount-percent"
            >{{ book.discount_percent|floatformat:2 }}% off</span
          >
        </p>
        {% else %}
        <p>
          <span class="highlight-price">${{ book.price|floatformat:2 }}</span>
        </p>
        {% endif %}

        <!-- Buttons below price -->
        <div class="price-buttons">
          <button class="btn add-to-cart" onclick="addToCart({{ book.id }})">
            Add to Cart
          </button>
          <button
            class="btn see-details"
            onclick="window.location.href='{% url 'product_detail' book.pk %}'"
          >
            See Details
          </button>
          <button
            class="btn wishlist-btn {% if book in user.profile.wishlist.all %}wishlisted{% endif %}"
            onclick="toggleWishlist({{ book.id }})"
            data-id="{{ book.id }}"
          >
            <i class="fas fa-heart"></i>
          </button>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Button Arrows -->
  <div class="arrows">
    <button id="prev">&lt;</button>
    <button id="next">&gt;</button>
  </div>
  <br /><br /><br /><br /><br />
  <!-- Thumbnails -->
  <div class="thumbnail">
    {% for book in best_sellers %}
    <div class="item {% if forloop.first %}active{% endif %}">
      <img src="{{ book.thumbnail_image_url }}" alt="{{ book.title }}" />
    </div>
    {% endfor %}
  </div>
</div>

<div class="recommended-section">
  <h2>Recommended For You</h2>
  <p>
    Explore these picks. We've selected these reads just for you—find your next
    favorite at your own pace.
  </p>
  <div class="books-container">
    {% for book in recommended_books %}
    <div class="book-card">
      <a href="{% url 'product_detail' book.pk %}">
        <img src="{{ book.thumbnail_image_url }}" alt="{{ book.title }}" />
      </a>
      <div class="book-info">
        <h3>{{ book.title }}</h3>
        {% if book.discount_percent > 0 %}
        <p><s>${{ book.price|floatformat:2 }}</s></p>
        <p>${{ book.discounted_price|floatformat:2 }}</p>
        {% else %}
        <p>${{ book.price|floatformat:2 }}</p>
        {% endif %}
        <br /><br />
        <button class="btn add-to-cart" onclick="addToCart({{ book.id }})">
          Add to Cart
        </button>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<div class="container-feature">
  <div class="header-title">
    <h2>Featured Product</h2>
    <p class="bottom-message-header">
      Check out our top pick of the moment—specially chosen to stand out.
      Discover what makes it a must-have.
    </p>
  </div>
  <div class="main-content">
    <div class="left-section">
      <div class="discover-bar">
        <span>FEATURED</span>
        <span class="arrow">_______</span>
      </div>
      <img
        src="{{ featured_book.image_url }}"
        alt="{{ featured_book.title }}"
        class="full-image"
      />
    </div>

    <div class="right-section">
      <h1>{{ featured_book.title }}</h1>
      <div class="author-category">
        <span class="author">{{ featured_book.author }}</span>
        <span class="category">{{ featured_book.category }}</span>
      </div>
      <p class="description">{{ featured_book.description }}</p>
      <div class="price">
        {% if featured_book.discount_percent > 0 %}
        <span class="original-price"
          ><s>${{ featured_book.price|floatformat:2 }}</s></span
        >
        <span class="discount-price"
          >${{ featured_book.discounted_price|floatformat:2 }}</span
        >
        {% else %}
        <span class="discount-price"
          >${{ featured_book.price|floatformat:2 }}</span
        >
        {% endif %}
      </div>
      <div class="buttons">
        <button class="btn-buy">Buy Now</button>
        <button class="btn-details">See Details</button>
      </div>
    </div>
  </div>
</div>

{% endblock %} {% block extra_js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="{% static 'js_files/landing_page.js' %}"></script>

<script>
    function addToCart(bookId) {
        var isAuthenticated = {{ user.is_authenticated|yesno:"true,false" }};  // Pass authenticated status

        if (!isAuthenticated) {
            // Trigger SweetAlert for non-authenticated users
            Swal.fire({
                icon: 'warning',
                title: 'Not Logged In',
                text: 'Please log in to add items to your cart.',
            });
            return;  // Stop execution if not authenticated
        }

        // Proceed with adding to cart for authenticated users
        $.ajax({
            url: "{% url 'add_to_cart' 0 %}".replace('0', bookId),
            method: "POST",
            headers: {
                "X-CSRFToken": "{{ csrf_token }}"
            },
            success: function(response) {
                // Trigger SweetAlert for successful addition
                Swal.fire({
                    icon: 'success',
                    title: 'Success!',
                    text: 'Item added to cart.',
                    confirmButtonText: 'OK'
                });
                // Update the cart count dynamically
                $(".cart-count").text('(' + response.cart_item_count + ')');
            },
            error: function(xhr) {
                // Simply ignore errors, allowing multiple additions
                // Optionally, you could log the error to the console
                console.error('Error adding item to cart:', xhr);
            }
        });
    }

    function toggleWishlist(bookId) {
      var isAuthenticated = {{ user.is_authenticated|yesno:"true,false" }};

      if (!isAuthenticated) {
          Swal.fire({
              icon: 'warning',
              title: 'Not Logged In',
              text: 'Please log in to add items to your wishlist.',
          });
          return;
      }

      $.ajax({
        url: "{% url 'toggle_wishlist' 0 %}".replace('0', bookId),
        method: "POST",
        headers: {
            "X-CSRFToken": "{{ csrf_token }}",
        },
        success: function(response) {
            const button = document.querySelector(`.wishlist-btn[data-id="${bookId}"]`);
            // Toggle the 'wishlisted' class based on response status
            if (response.status === "added") {
                button.classList.add("wishlisted");
            } else if (response.status === "removed") {
                button.classList.remove("wishlisted");
            }
        },
        error: function(xhr) {
            console.error("Error toggling wishlist:", xhr);
        },
    });
  }
</script>

{% endblock %}
